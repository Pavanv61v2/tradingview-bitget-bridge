name: Deploy Dashboard

on:
  workflow_dispatch:  # Manual trigger

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      
      - name: Setup Git
        run: |
          git config --global user.name "GitHub Action"
          git config --global user.email "action@github.com"
      
      - name: Create gh-pages branch if it doesn't exist
        run: |
          git checkout -b gh-pages || git checkout gh-pages
          git pull origin gh-pages --rebase || echo "No gh-pages branch yet"
      
      - name: Create sample trade history
        run: |
          echo '[
            {
              "timestamp": "2025-03-20T12:00:00.000Z",
              "symbol": "BTCUSDT",
              "action": "buy",
              "originalAmount": 100,
              "orderSize": "100.00",
              "orderId": "12345678",
              "status": "success"
            },
            {
              "timestamp": "2025-03-20T13:30:00.000Z",
              "symbol": "BTCUSDT",
              "action": "sell",
              "originalAmount": 0.002,
              "orderSize": "0.002",
              "orderId": "12345679",
              "status": "success"
            },
            {
              "timestamp": "2025-03-21T09:15:00.000Z",
              "symbol": "SOLUSDT",
              "action": "buy",
              "originalAmount": 200,
              "orderSize": "200.00",
              "orderId": "12345680",
              "status": "success"
            }
          ]' > trade_history.json
      
      - name: Deploy to GitHub Pages
        run: |
          # Make sure index.html exists on this branch
          cp index.html index.html || echo "index.html already exists"
          
          # Add all changes
          git add .
          git commit -m "Update dashboard" || echo "No changes to commit"
          
          # Push to gh-pages branch
          git push origin gh-pages --force

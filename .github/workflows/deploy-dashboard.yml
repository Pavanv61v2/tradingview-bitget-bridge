name: Deploy Dashboard

on:
  workflow_dispatch:  # Manual trigger

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    # Add permission for GitHub Pages
    permissions:
      contents: read
      pages: write
      id-token: write
    
    # Deploy to the github-pages environment
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      
      # Explicitly add the missing dependency
      - name: Setup Upload Artifact
        uses: actions/upload-artifact@v3
        with:
          name: dummy-artifact
          path: README.md
          retention-days: 1
          if-no-files-found: ignore
      
      - name: Setup GitHub Pages
        uses: actions/configure-pages@v3
        
      - name: Create site directory
        run: mkdir -p _site
          
      - name: Copy index.html to site directory
        run: cp index.html _site/index.html
      
      - name: Create sample trade history
        run: |
          echo '[
            {
              "timestamp": "2025-03-20T12:00:00.000Z",
              "symbol": "BTCUSDT",
              "action": "buy",
              "originalAmount": 100,
              "orderSize": "100.00",
              "orderId": "12345678",
              "status": "success"
            },
            {
              "timestamp": "2025-03-20T13:30:00.000Z",
              "symbol": "BTCUSDT",
              "action": "sell",
              "originalAmount": 0.002,
              "orderSize": "0.002",
              "orderId": "12345679",
              "status": "success"
            },
            {
              "timestamp": "2025-03-21T09:15:00.000Z",
              "symbol": "SOLUSDT",
              "action": "buy",
              "originalAmount": 200,
              "orderSize": "200.00",
              "orderId": "12345680",
              "status": "success"
            }
          ]' > _site/trade_history.json
      
      # Use a direct zip and upload approach
      - name: Archive site contents
        run: |
          cd _site
          zip -r ../artifact.zip .
      
      - name: Upload artifact
        uses: actions/upload-artifact@v3
        with:
          name: github-pages
          path: artifact.zip
          retention-days: 1
      
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v1
